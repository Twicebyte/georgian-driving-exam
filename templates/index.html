<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#f6f9ff"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <link rel="apple-touch-icon" href="{{ url_for('static', filename='logo.png') }}">
        <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
        <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}" />
        <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,700,1,0" />
        <title>Georgian Driving Exam</title>
    </head>
    <body>
        <script>

            function add_started() {
                stats_exams_started += 1;
                send_stats();
            };

            function add_exam() {
                stats_exams += 1;
                if (correct == allnum)
                    stats_exams_perfect += 1;
                send_stats();
            };

            function add_incorrect() {
                stats_questions += 1;
                send_stats();
            };

            function add_correct() {
                stats_questions += 1;
                stats_correct += 1;
                send_stats();
            };

            function update_stats() {
                document.getElementById("stats-started").innerHTML = stats_exams_started;
                document.getElementById("stats-completed").innerHTML = stats_exams_completed + " (" + Math.round(100 * stats_exams_completed / stats_exams_started) + " %)";
                document.getElementById("stats-perfect").innerHTML = stats_exams_perfect + " (" + Math.round(100 * stats_exams_perfect / stats_exams_completed) + " %)";
                document.getElementById("stats-questions").innerHTML = stats_questions;
                document.getElementById("stats-correct").innerHTML = Math.round(100 * stats_correct / stats_questions) + " %";

            };

            function send_stats() {
                var xhr = new XMLHttpRequest();
                xhr.open("POST", "/stats", true);
                xhr.setRequestHeader('Content-Type', 'application/json');
                xhr.send(JSON.stringify({
                    "started": stats_exams_started,
                    "completed": stats_exams_completed,
                    "perfect": stats_exams_perfect,
                    "questions": stats_questions,
                    "correct": stats_correct
                }));
            };
        </script>
        <script src="{{ url_for('static', filename='script.js') }}" defer></script>
        <data class="hidden" id="stats_exams_started">{{ session.get('stats-started', 0) }}</data>
        <data class="hidden" id="stats_exams_completed">{{ session.get('stats-completed', 0) }}</data>
        <data class="hidden" id="stats_exams_perfect">{{ session.get('stats-perfect', 0) }}</data>
        <data class="hidden" id="stats_questions">{{ session.get('stats-questions', 0) }}</data>
        <data class="hidden" id="stats_correct">{{ session.get('stats-correct', 0) }}</data>
        <div class="header" id="header">
            <h1>Georgian Driving Exam</h1>
        </div>
        <div class="ticket-container">
            <div class="placeholder"></div>
            <section>
                <div class="snap">
                    <div class="ticket" style="width: 80vw; max-width: 600px;">
                        <div class="linklist" style="display: flex; flex-direction: row; align-items: center; justify-content: center;">
                            <img class="profilepic" src="{{ session.get('pic') }}" style="margin: 8px; margin-right: 24px; clip-path: circle();">
                            <div class="linklist" style="margin: 0; flex-direction: column; display: flex; align-items: baseline;">
                                <h2>Меню</h2>
                                <span>{{ session.get('user') }}</span>
                                <div class="linklist" style="margin: 8px;">
                                    <span class="hidden nextexam" id="butInstall">Установить</span>
                                    <span class="nextexam" onclick="logout(this)">Выйти</span>
                                </div>
                            </div>
                        </div>
                        <div class="linklist" style="margin: 8px;">
                            <span class="stat key">Начато</span>
                            <span class="stat" id="stats-started"></span>
                        </div>
                        <div class="linklist" style="margin: 8px;">
                            <span class="stat key">Пройдено</span>
                            <span class="stat" id="stats-completed"></span>
                        </div>
                        <div class="linklist" style="margin: 8px;">
                            <span class="stat key">Идеально</span>
                            <span class="stat" id="stats-perfect"></span>
                        </div>
                        <div class="linklist" style="margin: 8px;">
                            <span class="stat key">Билеты</span>
                            <span class="stat" id="stats-questions"></span>
                        </div>
                        <div class="linklist" style="margin: 8px;">
                            <span class="stat key">Точность</span>
                            <span class="stat" id="stats-correct"></span>
                        </div>
                        <script>
                            var stats_exams_started = parseInt(document.getElementById("stats_exams_started").innerHTML);
                            var stats_exams_completed = parseInt(document.getElementById("stats_exams_completed").innerHTML);
                            var stats_exams_perfect = parseInt(document.getElementById("stats_exams_perfect").innerHTML);
                            var stats_questions = parseInt(document.getElementById("stats_questions").innerHTML);
                            var stats_correct = parseInt(document.getElementById("stats_correct").innerHTML);
                            update_stats();
                        </script>
                    </div>
                </div>
            </section>
            <section id="stack">
                <div class="snap">
                    <div class="ticket">
                        <div class="linklist" style="align-items: center;">
                            <span class="material-symbols-rounded" style="margin: 8px; font-size: xxx-large; color: #2cbd2c; text-shadow: 1px 1px 4px rgba(0,0,0,0.2);">play_arrow</span>
                            <span class="nextexam" onclick="recreate()">
                                Начать экзамен
                            </span>
                        </div>
                    </div>
                </div>
            </section>
            <div class="placeholder"></div>
        </div>
    </body>
</html>
